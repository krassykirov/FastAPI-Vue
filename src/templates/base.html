<html>
<head>
    <title>Demo</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
    <script src="../static/js/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js" integrity="sha512-rstIgDs0xPgmG6RX1Aba4KV5cWJbAMcvRCVmglpam9SoHZiUCyQVDdH2LPlxoHtrv17XWblE/V/PP+Tr04hbtA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
</head>

<body style="margin-left:10; margin-right:10">
  <nav class="navbar navbar-expand-lg navbar-light bg-light">
    <a class="navbar-brand" href="#">Test</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item active">
          <a class="nav-link" href="{{ url_for('home')}}">Home <span class="sr-only">(current)</span></a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="{{ url_for('get_items')}}">Events</a>
        </li>
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Cars
          </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">

            <div class="dropdown-divider"></div>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </li>
      </ul>
    </div>
  </nav>

  <div style="display: inline;">
      Category Name: <input type="text" id="cat-name" required >
      <button class="btn btn-primary" id="create-cat">Create Category</button>
  </div>
<hr>
  Categories: <button id="fetch-button" class="btn btn-primary"> Show Categories </button>
  <div id="categories" style="display: none;"></div>
  <hr>
</br>
  Items: <button id="fetch-button2" class="btn btn-primary"> Show Items </button>
  <div id="events" style="display: none;"></div>
  <hr>

  <button class="btn btn-primary" id="btn-test">Test</button>
<div id="responseDiv";></div>

<!-- <div style="display: flex; justify-content: space-around">
  <div id="categories" style="display: none;">Left</div>
  <div id="responseDiv" style="display: none">Middle</div>
  <div id="events" style="display: none;">Right</div>
</div> -->

<div class="table">
  <table id="catalog-table" style="display: none">
      <thead>
      <tr>
          <!-- <th scope="col">&nbsp;</th> -->
          <th scope="col">Name</th>
          <th scope="col">Product Code</th>
          <th scope="col">Date</th>
          <th scope="col">Price</th>
          <th scope="col">&nbsp;</th>
          <!-- <th scope="col">&nbsp;</th> -->
      </tr>
      </thead>
      <tbody>

      </tbody>
  </table>
</div>


<script>
// fetchCategories
function fetchCategories() {
     fetch('/categories')
    .then(response => response.json())
    .then(data => {
      const updatedDiv = document.getElementById('categories')
      console.log('data', data)
      const FormattedData = data.map(item=> `Name: ${item.name}, ID: ${item.id}`).join('<br>')
      // $("#categories").show();
      // updatedDiv.innerHTML = `<p> Name: ${data.name}, ID ${data.id} <\p>`
      updatedDiv.innerHTML = FormattedData
      if (updatedDiv.style.display === "none") {
          updatedDiv.style.display = "block";
          document.getElementById('fetch-button').innerHTML = "Hide Categories"
        } else {
          updatedDiv.style.display = "none";
          document.getElementById('fetch-button').innerHTML = "Show Categories"
        }
    })
    .catch(error => console.log("error:", error))
}
document.getElementById('fetch-button').onclick = fetchCategories;

// fetchEvents
function fetchEvents() {
     fetch('/items')
    .then(response => response.json())
    .then(data => {
      const updatedDiv = document.getElementById('events')
      console.log('data', data)
      const FormattedData = data.map(item => `Product_code: ${item.product_code},
                                              Date: ${item.date},
                                              Price: ${item.price},
                                              Category: ${item.price}`).join('<br>')
      updatedDiv.innerHTML = FormattedData
      if (updatedDiv.style.display === "none") {
          updatedDiv.style.display = "block";
          document.getElementById('fetch-button2').innerHTML = "Hide Events"
        } else {
          updatedDiv.style.display = "none";
          document.getElementById('fetch-button2').innerHTML = "Show Events"
        }
    })
    .catch(error => console.log("error:", error))
}
document.getElementById('fetch-button2').onclick = fetchEvents;

// createCategory
async function createCategory() {
  const categoryName = document.getElementById('cat-name').value

  await fetch('/categories', {
       method: "POST",
       headers: {"Content-Type": "application/json",},
       body: JSON.stringify({"name": categoryName}), // body data type must match "Content-Type" header
  })
  .then(response => response.json())
  .then(result => {
       const responseDiv = document.getElementById('responseDiv');
       console.log('result', result)
       if (result.detail){
        responseDiv.innerHTML = `${result.detail}`
       }
       else {
       responseDiv.innerHTML = `Created Category: ${result.name}, ID: ${result.id} `;
       }
       if (responseDiv.style.display === "none") {
        responseDiv.style.display = "block";
        }
})
  .catch(error => console.log("error:", error));
}

document.getElementById('create-cat').onclick = createCategory;

// Test Function
async function postData() {
  const response = await fetch("/api/data", {
    method: "POST",
    headers: { "Content-Type": "application/json",},
    body: JSON.stringify({"name":"test"}), // body data type must match "Content-Type" header
  })
  .then(response => response.json())
  .then(result => {
   console.log('result:', result.name)
})
}

document.getElementById('btn-test').onclick = postData;

// table

function addItem(item) {
            console.log(item);
            $("#catalog-table").append(
                `<tr>
                <td class="event-product_code">${item.name}</td>
                <td class="event-product_code">${item.product_code}</td>
                <td class="event-date">${item.date}</td>
                <td class="event-price">$${parseFloat(item.price).toFixed(2)}</td>
                <td class="event-purchase-button"><a href="/details.html?id=${event.id}"><button>Purchase Details</button></a></td>
                </tr>`);
        }


$(document).ready(function () {

  $.ajax({
      url: "/items/",
      success: data => {
          $("#loading").hide();
          data.map(item => addItem(item));
          $("#catalog-table").show();
      },
      error: (_, textStatus, errorThrown) => {
          $("#loading p")[0].innerText = `${textStatus}: ${errorThrown}`;
      }
    });
});



</script>

</body>
</html>