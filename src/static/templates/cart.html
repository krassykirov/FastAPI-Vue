<!DOCTYPE html>
<head>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <script src="https://cdn.jsdelivr.net/npm/vue@3"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js" integrity="sha512-rstIgDs0xPgmG6RX1Aba4KV5cWJbAMcvRCVmglpam9SoHZiUCyQVDdH2LPlxoHtrv17XWblE/V/PP+Tr04hbtA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="../static/templates/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
<link rel="stylesheet" href="../static/css/main.css">
</head>
<style>
  .card-img {
    width: 100%;
    height: 14vw;
    object-fit: cover;
  }
  .card{
    width: 30rem;
    margin-bottom: auto;
    margin-right: auto;
    margin-top: 10px;
    /* margin-left: 50%; */
    /* border: 15px solid #969696; */
    text-align: center;
    box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
  }
</style>
  <nav class="navbar navbar-expand-lg bg-white sticky-top navbar-light p-3 shadow-lg" style="height: 70px; margin-left: 0; margin-right: 0;">
    <div class="container-fluid" style="font-size: 14px;">
      <a class="navbar-brand" href="#" style="font-size: 14px;"><i class="fa fa-home"></i> <strong>KRASSY SHOP</strong>
      </a>
      <div class="mx-auto my-3 d-lg-none d-sm-block d-xs-block">
        <div class="input-group">
          <span class="border-warning input-group-text bg-warning text-white"><i class="fa-solid fa-magnifying-glass"></i></span>
          <input type="text" class="form-control border-warning" style="color:#7a7a7a">
          <button class="btn btn-warning text-white">Search</button>
        </div>
      </div>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" aria-current="page" href="#">Offers</a>
          </li>
          <div class="dropdown">
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_products')}}">Products</a>
                  <!-- <div class="dropdown-content">
                    <a class="nav-link" data-toggle="modal" data-target="#addItem" href="#">Add Product</a>
                  </div> -->
            </div>
          </li>
          <div class="dropdown">
            <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_category')}}">Categories</a>
          </div>
          </li>
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="#">Services</a>
          </li>
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="#">About</a>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="#">
              <i class="bi bi-cart"></i> Cart <span id="cart-len" class="badge badge-primary">{{items|length}}</span></a>
               <!-- <div class="dropdown-content">
                {% for item in items %}
                <div class="d-flex align-items-center">
                  <img :src="'static/img/' + item.username + '/' + item.name + '/' + item.image" class="mr-2"
                     style="width: 50px; height: 60px; object-fit: cover; border-radius: 5px;">
                  <div style="cursor: pointer" @click="redirectToItemFromNavbar(item.id)">
                    <div> {{ item.price }} </div>
                  </div>
                </div>
                <div class="ml-3 font-weight-bold"></div>
                {% endfor %}
              </div> -->
            </div>
          </li>
        </ul>
      </div>
      {% if current_user %}
      <form class="form-inline my-2 my-lg-0" style="margin-right: 30px;">
        <div class="dropdown" style="font-family: Raleway; font-size: 16px;">
          {% if profile %}
          {{ current_user }} <img src="/static/img/{{ current_user }}/profile/{{ profile.avatar }}" class="avatar" alt="{{ current_user}}">
          {% else %}
          {{ current_user }} <img src="/static/img/img_avatar.png" class="avatar" alt="{{ current_user}}">
          {% endif %}
          <div class="dropdown-content">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_user_profile') }}"> Profile</a>
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('logout') }}"> Logout</a>
          </div>
        </div>
     </form>
      {% endif %}
    </div>
  </nav>

{% if not items %}
<h1> You don't have items in your Cart :( </h1>
{% endif %}
    {% for item in items %}
    <div class="card w-75" id="card{{ item.id }}" style="margin-left: 200px;">
        <div class="row no-gutters">
            <div class="col-md-3" style="background: #868e96;">
                {% if  'no-image.png' == item.image %}
                <img class="card-img" src="/static/img/{{ item.image }}">
                {% else %}
                <img class="card-img" src="/static/img/{{ item.username }}/{{item.name}}/{{ item.image }}">
                 {% endif %}
            </div>
            <div class="col-sm-7">
                <div class="card-body">
                    <h5 class="card-title">{{ item.name }} </h5>
                    <p class="card-text"> Price: ${{ '%0.2f'|format(item.price|float)  }}.</p>
                    <p class="card-text"> Category: {{ item.category.name.split('.')[-1] }}</p>
                    <input type="number" name="id" value="{{ item.id }}" id="id" hidden>
                    <input type="text" id="username" value="{{ current_user }}"  hidden>
                    <p>
                        <span class="fa fa-star checked" id="star{{ item.id }}1"></span>
                        <span class="fa fa-star checked" id="star{{ item.id }}2"></span>
                        <span class="fa fa-star checked" id="star{{ item.id }}3"></span>
                        <span class="fa fa-star" id="star{{ item.id }}4"></span>
                        <span class="fa fa-star" id="star{{ item.id }}5"></span>
                        <span id="overall-rating{{ item.id }}"> No rating Yet </span>
                    </p>
                    <a href="#" id="card{{ item.id }}" class="btn btn-primary" onclick="removeCard(this.id)">Remove from Cart</a>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}


<script>

function getItemRating(item_id){
  $.ajax({
        url: "/api/reviews/item/rating",
        method: "get",
        headers: { "Content-Type": "application/json",},
        data:  { "id": `${item_id}`
        },
        success: data => {
          for (var i=1; i<=5; i++ ){
            var star = document.getElementById('star'+ item_id + i )
            if ( i <= data.rating ){
                star.classList.add('checked');
            }
            else { star.classList.remove('checked')}
          }
        document.getElementById('overall-rating'+ item_id).innerText = '  (' + data.review_number + ')'
        },
        error: (error) => {
            console.log('error:', error);
        }
      });
   }

{% for item in items %}
var item_id = '{{ item.id }}'
getItemRating(item_id)
{% endfor %}


function removeCard(cardID){
    var card = document.getElementById(cardID)
    var item_id = cardID.replace('card', "")
    card.remove()
    $.ajax({
        url: "/user/remove-from-basket",
        method: "post",
        headers: { "Content-Type": "application/json",},
        data: JSON.stringify({
          "item_id": `${item_id}`,
        }),
        success: data => {
            console.log('success')
        },
        error: (error) => {
            console.log('error:', error);
        }
      });
}

</script>


<html>