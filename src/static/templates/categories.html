{% extends "base.html" %}

{% block html_read %}
{% block javascript %}
    <script type="text/javascript">
        {% include "js/main.js" %}
    </script>
{% endblock %}

</br>

  <div class="container-breadcrumb" style="margin-top: 13px;">
    <nav style="--bs-breadcrumb-divider: '';" aria-label="breadcrumb">
     <ol class="breadcrumb">
       <li class="breadcrumb-item"><a href="#">Categories</a></li>
       <li class="breadcrumb-item" data-category="Finance"><a href="#Finance">Finance</a></li>
       <li class="breadcrumb-item" data-category="Services"><a href="#Services">Services</a></li>
       <li class="breadcrumb-item" data-category="TV"><a href="#TV">TV</a></li>
       <li class="breadcrumb-item" data-category="IT"><a href="#IT">IT</a></li>
       <li class="breadcrumb-item" data-category="Miscellaneous"><a href="#Miscellaneous">Miscellaneous</a></li>
     </ol>
   </nav>
   </div>

{%  if items  %}
<div class="container">

<div class="row" id="itemsContainer">
  </div>
  {% for item in items %}
      {% endfor %}
    </div>
    </div>
{%  else  %}
No Items in Category found
{% endif  %}

<!-- <button type="button" class="btn btn-primary" id="liveToastBtn">Show live toast</button>

<div aria-live="polite" aria-atomic="true" style="position: relative; min-height: 200px;"></div>
<div style="position: absolute; bottom: 5; right: 5;">
  <div id="liveToast" class="toast hide" role="alert" aria-live="assertive" aria-atomic="true" data-delay="5000" data-animation="true">
    <div class="toast-header">
      <strong class="mr-auto">Bootstrap</strong>
      <small>11 mins ago</small>
      <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
        <span aria-hidden="true">&times;</span>
      </button>
    </div>
    <div class="toast-body">
      Hello, world! This is a toast message.
    </div>
  </div>
  </div>
</div> -->


<script>

function getItemRating(item_id){
  $.ajax({
        url: "/api/reviews/item/rating",
        method: "get",
        headers: { "Content-Type": "application/json",},
        data:  { "id": `${item_id}`
        },
        success: data => {
          for (var i=1; i<=5; i++ ){
            var star = document.getElementById('star'+ item_id + i )
            if ( i <= data.rating ){
                star.classList.add('checked');
            }
            else { star.classList.remove('checked')}
          }
        document.getElementById('overall-rating'+ item_id).innerText = '  (' + data.review_number + ')'
        },
        error: (error) => {
            console.log('error:', error);
        }
      });
   }

$(document).ready(function() {
    $('.breadcrumb-item').on('click', function() {
      var category= $(this).data('category');
      console.log('category', category)
    $.ajax({
    url: "/category",
    method: "post",
    data:  JSON.stringify({
          "category": `${category}`,
        }),
    success: data => {
      console.log('data', data)
      const itemsContainer = $('#itemsContainer');
      itemsContainer.empty()
      data.forEach(item => {
        console.log("item:", item)
        var itemHtml =  `
          <div class="col-lg-auto">
              <div class="card"  id="card${item.id}">
            <div class="card-body"  style="cursor: pointer"; onclick="location.href='url_for('read_item', id=${item.id})'" >
               <div class="card-body"  style="cursor: pointer"; onclick="location.href='url_for('read_item', id=${item.id})'" >
              <img class="card-img-top" src="/static/img/${item.username}/${item.name}/${item.image}">
            <h5 class="card-title">${item.name} </h5>
            <div class="dropdown">
            <a href="url_for('read_item', id=${item.id})"><button class="btn btn-secondary stretched-link">Purchase Details</button></a>
          </div>
          <p>
          <span class="fa fa-star checked" id="star${item.id}1"></span>
          <span class="fa fa-star checked" id="star${item.id}2"></span>
          <span class="fa fa-star checked" id="star${item.id}3"></span>
          <span class="fa fa-star" id="star${item.id}4"></span>
          <span class="fa fa-star" id="star${item.id}5"></span>
          <span id="overall-rating${item.id}"> No rating Yet </span>
          </p>
            <div class="card-footer">
              <small class="text-muted">Created: ${item}.date.strftime('%Y-%m-%d') }} by ${item.username}</small>
            </div>
          </div>
          </div>
      </div>
    `
     getItemRating(`${item.id}`)
     itemsContainer.append(itemHtml)
      });

    },
    error: (response) => {
      if (response.status === 403) {
        $("#comment-area").val(response.responseJSON.detail)
      }
        }
      });
   }
)});


// const toastTrigger = document.getElementById('liveToastBtn')
// const toastLiveExample = document.getElementById('liveToast')
// if (toastTrigger) {
//   toastTrigger.addEventListener('click', () => {
//     const toast = new bootstrap.Toast(toastLiveExample)

//     toast.show()
//   })
// }

</script>

{% endblock %}