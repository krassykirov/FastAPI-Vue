<!DOCTYPE html>
<head>
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js" integrity="sha512-rstIgDs0xPgmG6RX1Aba4KV5cWJbAMcvRCVmglpam9SoHZiUCyQVDdH2LPlxoHtrv17XWblE/V/PP+Tr04hbtA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="../static/templates/js/main.js"></script>
<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
<link rel="stylesheet" href="../static/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css">
</head>

<body>
  <nav class="navbar navbar-expand-lg bg-white sticky-top navbar-light p-3 shadow-lg" style="height: 70px; margin-left: 0; margin-right: 0;">
    <div class="container-fluid" style="font-size: 14px;">
      <a class="navbar-brand" href="#" style="font-size: 14px;"><i class="fa fa-home"></i> <strong>KRASSY SHOP</strong>
      </a>
      <div class="mx-auto my-3 d-lg-none d-sm-block d-xs-block">
        <div class="input-group">
          <span class="border-warning input-group-text bg-warning text-white"><i class="fa-solid fa-magnifying-glass"></i></span>
          <input type="text" class="form-control border-warning" style="color:#7a7a7a">
          <button class="btn btn-warning text-white">Search</button>
        </div>
      </div>
      <div class="collapse navbar-collapse" id="navbarNavDropdown">
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" aria-current="page" href="#">Offers</a>
          </li>
          <div class="dropdown">
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_products')}}">Products</a>
                  <!-- <div class="dropdown-content">
                    <a class="nav-link" data-toggle="modal" data-target="#addItem" href="#">Add Product</a>
                  </div> -->
            </div>
          </li>
          <div class="dropdown">
            <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_category')}}">Categories</a>
          </div>
          </li>
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="#">Services</a>
          </li>
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="#">About</a>
          </li>
        </ul>
        <ul class="navbar-nav ms-auto ">
          <li class="nav-item">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_user_in_cart_len')}}">
              <i class="bi bi-cart"></i> Cart <span id="cart-len" class="badge badge-primary"></span></a>
          </li>
        </ul>
      </div>
      {% if current_user %}
      <form class="form-inline my-2 my-lg-0" style="margin-right: 30px;">
        <div class="dropdown" style="font-family: Raleway; font-size: 16px;">
          {% if profile %}
          {{ current_user }} <img src="/static/img/{{ current_user }}/profile/{{ profile.avatar }}" class="avatar" alt="{{ current_user}}">
          {% else %}
          {{ current_user }} <img src="/static/img/img_avatar.png" class="avatar" alt="{{ current_user}}">
          {% endif %}
          <div class="dropdown-content">
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('get_user_profile') }}"> Profile</a>
            <a class="nav-link mx-2 text-uppercase" href="{{ url_for('logout') }}"> Logout</a>
          </div>
        </div>
     </form>
      {% endif %}
    </div>
  </nav>

<style>
    .card {
      box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2);
      /* max-width: 300px; */
      margin: auto;
      text-align: center;
      font-family: arial;
    }

    .title {
      color: grey;
      font-size: 18px;
    }

    button {
      border: none;
      outline: 0;
      display: inline-block;
      padding: 8px;
      color: white;
      background-color: #000;
      text-align: center;
      cursor: pointer;
      width: 100%;
      font-size: 18px;
    }

    </style>

{% if profile %}
    <div class="card">
      <img src="/static/img/{{ current_user }}/profile/{{ profile.avatar }}" id="avatar-image" style="width:100%">
      <h1 id="current_user">{{ current_user }}</h1>
      <p class="title">CEO & Founder, Birds</p>
      <p id="card-email">Email: {{ profile.email }}</p>
      <p id="card-phone">Phone: {{ profile.number }}</p>
      <p id="card-address">Address: {{ profile.address }}</p>
      <div style="margin: 24px 0;">
        <a href="#"><i class="fa fa-dribbble"></i></a> 
        <a href="#"><i class="fa fa-twitter"></i></a>  
        <a href="#"><i class="fa fa-linkedin"></i></a>  
        <a href="#"><i class="fa fa-facebook"></i></a> 
      </div>
      <p><button>Contact</button></p>
    </div>
    <button class="dropbtn" data-toggle="modal" data-target="#UpdateProfile" style="float: left;">Update Profile</button>
{%  else  %}
<h2 style="text-align:center">No Profile yet, create one?</h2>
<button class="dropbtn" data-toggle="modal" data-target="#addProfile" style="float: left;">Add Profile</button>
    {% endif %}

    <div class="modal fade" id="addProfile" tabindex="-1" role="dialog" aria-labelledby="addProfileLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="addProfileLabel">Create Profile</h5>
            </div>
            <div class="modal-body">
              <form action="create_profile" id=create-profile method="post" enctype="multipart/form-data" data-toggle="validator" id="addProfileForm">
                <div class="form-group">
                  <label for="email" class="col-form-label">Secondary Email:</label>
                  <input type="email" name="email" id="email" placeholder="Email" required>
                  <!-- <input type="text" name="name" id="item-name" pattern="^[a-zA-Z]*" oninvalid="setCustomValidity('Please use only letters')" placeholder="Item Name"  required> -->
                </div>
                <div class="form-group">
                  <label for="number" class="col-form-label">Number:</label>
                  <input type="tel" name="number" id="tel-number" placeholder="Telephone number" required>
               </div>

                <div class="form-group">
                  <label for="address" class="col-form-label">Number:</label>
                  <input type="text" name="address" id="address" placeholder="Address">
               </div>
                <div class="form-group" form-group-file>
                  <label for="file" class="col-form-label">Upload Avatar Photo:</label>
                  <input type="file" id="file" name="file" class="form-control" data-filesize="1000000" data-filesize-error="File must be smaller then 1MB" accept="image/*" required/>
                </div>
                <button id="submit-button" class="btn btn-primary">Submit</button>
                <button id="Close-Profile" type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </form>
            </div>
          </div>
        </div>
      </div>


    <div class="modal fade" id="UpdateProfile" role="dialog" aria-labelledby="UpdateProfileLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="UpdateProfileLabel"> Update Profile</h5>
            </div>
            <div class="modal-body">
              <form id="update-profile" enctype="multipart/form-data" data-toggle="validator" id="UpdateModalForm">
                <div class="form-group">
                  <label for="email" class="col-form-label">Secondary Email:</label>
                  <input type="email" name="email" id="email" placeholder="Email">
             </div>
                <div class="form-group">
                  <label for="number" class="col-form-label">Number:</label>
                  <input type="tel" name="number" id="tel-number" placeholder="Telephone number">
               </div>
                <div class="form-group">
                  <label for="address" class="col-form-label">Address:</label>
                  <input type="text" name="address" id="address" placeholder="Address">
               </div>
                <div class="form-group" form-group-file>
                  <label for="file" class="col-form-label">Upload Avatar Photo:</label>
                  <input type="file" id="file" name="file" class="form-control" data-filesize="1000000" data-filesize-error="File must be smaller then 1MB" accept="image/*"/>
                </div>
                <button id="update-submit-button" class="btn btn-primary" style="margin-bottom:5px;">Save</button>
                <button type="button" id="Close-Update-Profile" class="btn btn-secondary" data-dismiss="modal">Close</button>
              </form>
            </div>
          </div>
        </div>
      </div>

<script>

$(document).ready(function() {
  $('#update-profile').submit(function(e) {
    e.preventDefault();
    var formData = new FormData(this)
    $.ajax({
        url: "/user/update_profile",
        type: "POST",
        processData: false,
        contentType: false,
        data: formData,
        success: function(data){
            updateCard(data)
            $('#UpdateProfile').modal('hide')
        },
        error: function (xhr) {
            if (xhr.status === 404) {
               $('#UpdateProfileLabel').text('Unable to process Profile update, please try again later!')
            }
        }
      });
   }
)});


$(document).ready(function() {
  $('#create-profile').submit(function(e) {
    e.preventDefault();
    var formData = new FormData(this)
    $.ajax({
        url: "/user/create_profile",
        type: "POST",
        processData: false,
        contentType: false,
        data: formData,
        success: function(data){
              $('#addProfile').modal('hide')
              window.location.href = "/user/profile"
        },
        error: function (xhr) {
            if (xhr.status === 404) {
               $('#UpdateProfileLabel').text('Unable to process Profile update, please try again later!')
            }
        }
      });
   }
)});

function updateCard(data){
    var user = '{{ current_user }}'
    var img_path = `/static/img/${user}/profile/${data.avatar}`;
    $('#card-email').text(`Email: ${data.email}`)
    $('#card-address').text(`Address: ${data.address}`)
    $('#card-phone').text(`Address: ${data.number}`)
    $('#avatar-image').attr('src', img_path);
}
</script>
